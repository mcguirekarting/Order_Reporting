modules = ["python-3.11"]
[agent]
expertMode = true

[nix]
channel = "stable-25_05"
packages = ["cairo", "cargo", "ffmpeg-full", "freetype", "ghostscript", "glibcLocales", "gobject-introspection", "gtk3", "libiconv", "pkg-config", "qhull", "rustc", "tcl", "tk"]

[userenv]

[userenv.shared]
AIRFLOW_HOME = "/home/runner/workspace/airflow_home"
AIRFLOW__CORE__DAGS_FOLDER = "/home/runner/MAO-Reporting/dags"
AIRFLOW__CORE__LOAD_EXAMPLES = "False"
AIRFLOW__WEBSERVER__EXPOSE_CONFIG = "True"
AIRFLOW__WEBSERVER__WEB_SERVER_HOST = "0.0.0.0"
AIRFLOW__WEBSERVER__WEB_SERVER_PORT = "5000"
AIRFLOW__CORE__EXECUTOR = "SequentialExecutor"
PYTHONPATH = "/home/runner/MAO-Reporting"
AIRFLOW__CORE__SQL_ALCHEMY_CONN = "sqlite:////home/runner/workspace/airflow_home/airflow.db"
AIRFLOW__DATABASE__SQL_ALCHEMY_CONN = "sqlite:////home/runner/workspace/airflow_home/airflow.db"

[workflows]
runButton = "Project"

[[workflows.workflow]]
name = "Project"
mode = "parallel"
author = "agent"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Airflow Webserver"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Flask Dashboard"

[[workflows.workflow]]
name = "Airflow Webserver"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "export AIRFLOW_HOME=/home/runner/workspace/airflow_home && export AIRFLOW__DATABASE__SQL_ALCHEMY_CONN=sqlite:////home/runner/workspace/airflow_home/airflow.db && export AIRFLOW__CORE__DAGS_FOLDER=/home/runner/workspace/dags && export AIRFLOW__CORE__LOAD_EXAMPLES=False && export AIRFLOW__WEBSERVER__WEB_SERVER_HOST=0.0.0.0 && export AIRFLOW__WEBSERVER__WEB_SERVER_PORT=5000 && airflow scheduler & airflow webserver --port 5000 --hostname 0.0.0.0"
waitForPort = 5000

[workflows.workflow.metadata]
outputType = "webview"

[[workflows.workflow]]
name = "Flask Dashboard"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "python -m flask --app dashboard.app run --host=0.0.0.0 --port=5000"
waitForPort = 5000

[workflows.workflow.metadata]
outputType = "webview"

[[ports]]
localPort = 5000
externalPort = 80
